# Book Friend Finder - Firebase Deployment

This is the production-ready version optimized for Firebase/Cloud deployment.

## Key Differences from `hardcover/`

- ✅ No TensorFlow on server (pre-computed recommendations)
- ✅ Fast startup (<1 second vs 30 seconds)
- ✅ Minimal dependencies (Flask only vs TensorFlow + NumPy + scikit-learn)
- ✅ Small container (~100MB vs ~1GB)
- ✅ Cheap to run (128MB RAM vs 1GB)

## Setup Process

### Step 1: Pre-compute Recommendations (LOCAL)

Run this on your local machine (where you have TensorFlow):

```bash
cd /Users/robin/git/hardcover-live
python3 precompute_all.py
```

This will:
- Load your data from `~/data/hardcover/`
- Train the TensorFlow model
- Generate recommendations for all users
- Save to `webapp/data/`:
  - `recommendations.json` (~5-10MB)
  - `users.json` (~100KB)
  - `clusters.json` (~50KB)

**Time:** ~30-40 seconds (run once)

### Step 2: Test Locally

```bash
cd webapp
python3 app.py
```

Open http://localhost:8000 - should start instantly!

### Step 3: Deploy to Cloud Run

```bash
cd webapp

# Deploy
gcloud run deploy book-friend-finder \
  --source . \
  --region us-central1 \
  --allow-unauthenticated \
  --memory=512Mi \
  --min-instances=0

# You'll get a URL like:
# https://book-friend-finder-xxx.run.app
```

**Or keep 1 instance warm (no cold starts):**

```bash
gcloud run deploy book-friend-finder \
  --source . \
  --region us-central1 \
  --allow-unauthenticated \
  --memory=512Mi \
  --min-instances=1  # Always 1 running instance
```

Cost: ~$7/month for always-on instance.

## File Structure

```
hardcover-live/
├── precompute_all.py          # Run locally to generate data
├── webapp/
│   ├── app.py                 # Simplified Flask app (no ML)
│   ├── requirements.txt       # Just Flask + gunicorn
│   ├── data/                  # Generated by precompute_all.py
│   │   ├── recommendations.json
│   │   ├── users.json
│   │   └── clusters.json
│   └── templates/             # HTML templates (unchanged)
│       ├── index.html
│       ├── results.html
│       └── cluster.html
└── README-DEPLOYMENT.md       # This file
```

## Updating Data

When you collect more users:

```bash
# 1. Update data (in hardcover/ directory)
cd /Users/robin/git/hardcover
python3 process_batch.py

# 2. Re-generate recommendations (in hardcover-live/ directory)
cd /Users/robin/git/hardcover-live
python3 precompute_all.py

# 3. Re-deploy
cd webapp
gcloud run deploy book-friend-finder --source .
```

## Performance Comparison

| Metric | Old (ML on server) | New (Pre-computed) |
|--------|-------------------|-------------------|
| Startup time | 30 seconds | <1 second |
| Memory needed | 1GB | 128MB |
| Container size | ~1GB | ~100MB |
| Dependencies | TF+NumPy+sklearn | Flask only |
| Response time | <100ms | <50ms |
| Cold start | 30 seconds | 1 second |
| Cost (always-on) | ~$15/mo | ~$5/mo |

## Deployment Options

### Option 1: Google Cloud Run (Recommended)
- Easiest deployment
- Auto-scales to zero
- Pay per request
- Free tier: 2M requests/month

### Option 2: Railway
- Simple git-based deployment
- Free tier available
- `railway up`

### Option 3: Render
- Free tier
- Auto-deploys from GitHub
- `render.yaml` config

### Option 4: Heroku
- Classic PaaS
- `git push heroku main`

## Troubleshooting

**ERROR: recommendations.json not found**
- Run `python3 precompute_all.py` first

**App starts but shows no users**
- Check that `webapp/data/*.json` files exist
- Verify files were generated correctly

**Users list is empty**
- Re-run `python3 precompute_all.py`
- Check ~/data/hardcover/ has valid data

## Notes

- The `hardcover/` directory is unchanged - use it for development
- This directory (`hardcover-live/`) is for deployment only
- Always run `precompute_all.py` after updating data
- Pre-computed files can be version controlled (they're just JSON)
